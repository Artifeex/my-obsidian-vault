![[Pasted image 20240927121435.png]]
![[Pasted image 20240927121451.png]]
Статья по оконным функциям: [https://habr.com/ru/articles/664000/](https://habr.com/ru/articles/664000/)
![[Pasted image 20240927121538.png]]
Итого: в оконных функциях мы можем использовать одну из агрегирующих функций или оконных функций, затем пишем OVER в котором определяем по каким столбцам хотим группировать и если хотим еще и сортировку внутри окна, то используем order by.
![[Pasted image 20240927121627.png]]

Оконная функция выполняет вычисления по множеству строк таблицы, которые некоторым образом связаны с текущей строкой. Это похоже по типу с вычислениями, которые могут выполняться с помощью агрегатных функций. Но, в отличие от обычных агрегатных функций, использование оконных функций не вызывает группировку строк в единственную выходную строку - строки сохраняют свою отдельную идентичность. За кулисами оконная функция может получить доступ не только к текущей строке результата запроса.

### Сходство и различие между оконными и агрегатными функциями

  
Характерно как для оконных, так и агрегатных функций:  

  
- Работают с множеством строк
  
- Вычисляют агрегатные величины
  
- Группируют или секционируют данные по одному или нескольким столбцам

  
Агрегатные функции отличаются от оконных функций в следующем:  

  
- Использование GROUP BY для определения множества строк для агрегации
  
- Группировка строк на основе значений столбца
  
- Сворачивание строк в единственную строку для каждой определенной группы

  
Оконные функции отличаются от агрегатных функций в следующем:  

  
- Использование OVER() вместо GROUP BY для определения множества строк
  
- Использование большего числа функций в дополнение к агрегатным, например: [RANK()](http://www.sql-tutorial.ru/ru/book_rank_dense_rank_functions.html), [LAG(), LEAD()](http://www.sql-tutorial.ru/ru/book_lag_and_lead_functions.html)
  
- Могут группировать строки по их рангу, процентилю и т.д. в дополнение к значениям столбца
  
- Не сворачивают строки в единственную строку на группу
  
- Могут использовать скользящую рамку окна на основе текущей строки.
### Зачем использовать оконные функции?
Главное преимущество оконных функций состоит в том, что они позволяют работать как с агрегатными, так и неагрегатными значениями одновременно, поскольку строки не сворачиваются. Они также позволяют решить проблемы производительности. Например, вы можете использовать оконную функцию вместо выполнения самосоединения или декартова произведения.

