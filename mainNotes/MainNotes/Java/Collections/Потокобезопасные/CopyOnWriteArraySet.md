`CopyOnWriteArraySet` — это потокобезопасная реализация интерфейса `Set`, которая использует механизм копирования при записи (copy-on-write) для обеспечения безопасного многопоточного доступа. В основе `CopyOnWriteArraySet` лежит **`CopyOnWriteArrayList`**, то есть все элементы этого множества хранятся в виде массива, как и в случае с `CopyOnWriteArrayList`, и при каждом изменении создается новая копия массива.

При операциях вставки, сначала происходит проверка не содержится ли такой элемент в массиве. Т.е. происходит полная проходка по нему и если нет, то он уже добавляется. Причем для модификаций создается копия. Для итератора создается снимок на момент создания итератора. Модифицировать с помощью итератора нельзя. 

В общем, все один в один как в [[CopyOnWriteArrayList]], только дополнительно реализована уникальность элементов, путем проверки добавляемого элемента.

### Зачем тогда может понадобиться `CopyOnWriteArraySet`, если есть `CopyOnWriteArrayList`?

1. **Гарантия уникальности элементов**:
    
    - Основная цель использования `CopyOnWriteArraySet` заключается в обеспечении **уникальности элементов**, что является обязательным свойством всех реализаций интерфейса `Set`. В то время как `CopyOnWriteArrayList` допускает наличие дубликатов, `CopyOnWriteArraySet` гарантирует, что дубликатов не будет.
    - Если вы используете `CopyOnWriteArrayList`, то вам придётся вручную проверять наличие дубликатов перед добавлением нового элемента. В `CopyOnWriteArraySet` эта логика уже встроена.
2. **Логическая семантика `Set`**:
    
    - Использование `Set` в коде даёт четкую и явную семантику: множество — это коллекция уникальных элементов. Использование `CopyOnWriteArraySet` говорит о том, что вам нужно поддерживать множество элементов с уникальными значениями.
    - Это полезно с точки зрения **читаемости и поддержки кода**. Когда другие разработчики видят `Set`, они интуитивно понимают, что дубликаты недопустимы. Использование `CopyOnWriteArrayList` может сбивать с толку, поскольку он не накладывает таких ограничений.
3. **Потокобезопасность для редких модификаций**:
    
    - `CopyOnWriteArraySet` эффективен для **редких модификаций и большого количества чтений**, что делает его полезным в определённых сценариях многопоточной работы. Если у вас есть несколько потоков, которые часто читают элементы, но редко модифицируют их, то `CopyOnWriteArraySet` может быть предпочтительным вариантом для обеспечения уникальности элементов в конкурентной среде.
    - Важно отметить, что `CopyOnWriteArraySet`, как и `CopyOnWriteArrayList`, гарантирует **потокобезопасность без блокировок на чтение**.
4. **Необходимость соответствия интерфейсу `Set`**:
    
    - В некоторых случаях ваш код может требовать использования объекта, который реализует интерфейс `Set`. Например, если у вас есть метод или API, принимающий `Set`, а не `List`, тогда использование `CopyOnWriteArraySet` будет естественным решением для многопоточных сценариев, когда нужна потокобезопасность.

