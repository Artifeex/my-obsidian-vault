![[Pasted image 20240925235901.png]]
ThreadPoolExecutor - класс, который реализует интерфейс ExecutorService. ExecutorService - механизм для управления потоками и выполнения каких-то задач асинхронно. Он упрощает за нас создание потоков и их установку. Под капотом ExecutorService хранит набор потоков - ThreadPool. И эти потоки переиспользуются внутри для выполнения поступаемых задач. Задачи перераспределяются на данный пул потоков. Т.е. внутри ExecutorService есть еще очередь задач. Задачи поступают в очередь, ExecutorService смотрит, есть ли у него в пуле потоков какой-то свободный поток, если есть, то забирает задачу из очереди задачи отдает ее на выполнение потоку. Если нет свободного потока, то задача продолжает лежать в очереди задач, пока не появится свободный поток в пуле потоков.

Т.е. ExecutorService занимается тем, что принимает задачи и распределяет их по потокам, которые есть у него в тредпуле. Можно задавать размер тредпула(максимум потоков, минимум или чтобы было ровно столько-то потоков, можно задавать timeout жизни, например, если поток не был активен 30 сек, то уничтожить поток, чтобы не использовать ресурсы системы). Пул - это на самом деле паттерн! Он активно используется в том случае, если создание объекта - какая-то дорогостоящая операция и проще его сохранить, чтобы другие переиспользовали, а не создавали новый объект. Это часто используется для хранения соединения с БД. Например, в Spring используется HikariPool, и когда мы делаем запрос к БД, то не создается новое соединение, а используется соединение из HikariPool.

### Виды ExecutorService
Для создания различных ExecutorServic-ов используется Executors. Никак по-другому мы его создать не можем. Например, можем создать Executors.newFixedThreadPool(size).
- newFixedThreadPool - тред пул с ограниченным числом потоков, которое мы передали при его создании.
- cachedThreadPool - подходит для задач, когда есть неравномерная загрузка. Он может увеличивать количество потоков, которое есть в пуле. Если пришла задача, а потоков свободных нет, то создается новый поток.
- singleThreadExecutor - тред пул из одного потока. Полезно, когда задачи нужно выполнять в том порядке, в котором они пришли. Когда мы используем другие виды пулов, то мы не можем гарантировать, что задачи выполнятся в том порядке, в котором пришли, поскольку одна задача могла отправиться на 1 поток, другая на другой и какая-то из них могла выполниться быстрее другой.
- scheduledThreadPoolExecutor - особенностью является то, что когда мы отправляем какую-то задачу в ExecutorService, то она не сразу выполняется, а через какую-то временную задержку, которую мы сами указываем.
- workStealingPool - под капотом работает не на ThreadPoolExecutor, а на WorkJoinPool-е. У него другой механизм. У каждого потока есть своя очередь задач. И каждый поток выполняет свои задачи. НО, если поток закончил выполнять все свои задачи из очереди, то он может украсть задачу у другого потока и выполнить ее вместо него. Но не так часто используется в разработке.
