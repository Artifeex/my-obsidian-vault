`ThreadLocal` в Java — это специальный механизм, который позволяет создавать переменные, которые хранят данные, уникальные для каждого потока. Это означает, что каждый поток имеет свою собственную копию переменной, и изменения в одной копии не влияют на другие потоки.

Зачем нам использовать такие переменные?

ThreadLocal предоставляет абстракцию над локальными переменными по отношению к потоку исполнения java.lang.Thread.

ThreadLocal переменные отличаются от обычных тем, что у каждого потока свой собственный, индивидуально инициализируемый экземпляр переменной, доступ к которой он получает через методы get() или set().

У каждого потока, то есть экземпляра класса Thread, есть ассоциированная с ним таблица ThreadLocal-переменных. Ключами таблицы являются cсылки на объекты класса ThreadLocal, а значениями — ссылки на объекты, “захваченные” ThreadLocal-переменными.

Создается такая ThreadLocal переменная через обычный конструктор. И в нее кладется значение с помощью вызова метода set, а получаем значение вызовом метода get. Также можем удалять с помощью remove.

Где создается? Создаваться она может в одном месте, потом все равно, когда мы будем в каком-нибудь потоке обращаться к такой переменной и вставлять значение или получать, то уже будем работать с нашей собственной копией. Т.е. можем создать всего 1 threadLocal переменную и передать ее во все потоки, при этом уже на этапе работы значения, которые мы будем класть или забирать будут отличаться.

Примером использования может быть создание своего кэша для каждого потока. Или, например, какая-то статическая переменная, к которой все потоки будут иметь доступ может сильно тормозиться. Например, Random. Если мы всеми потоками будем стучаться в одну и ту же статическую переменную - то это будет медленнее, чем если бы мы в каждом потоке создали свою ThreadLocal переменную.




