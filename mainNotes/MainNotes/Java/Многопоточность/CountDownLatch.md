У нас будет ракета, которая состоит из частей. Когда все части будут готовы, то она полетит, до того, как они все будут готовы - ракета будет ждать своего пуска.
![[Pasted image 20241112120248.png]]
Есть ресурс, который мы будем шарить между всеми потоками - это защелка. И есть поток ракеты, который запускает ракету, а есть потоки помощники, который собирают кусочки этой ракеты. await - блокирует наш поток до тех пор, пока все помощники не декрементируют нашу защелку.
![[Pasted image 20241112120316.png]]![[Pasted image 20241112120328.png]]
![[Pasted image 20241112120343.png]]
Результат работы:
![[Pasted image 20241112120402.png]]
Т.е. когда защелка достигает 0(т.е. нужное количество раз вызван был метод countDown()), то она отпускает все потоки, которые заснули при вызове await()

Не забываем вызывать для наших локальных пулов их завершения, чтобы программа не висела:
![[Pasted image 20241112120500.png]]
shudown() - для того, чтобы когда задачи в threadPool закончились, то программа завершилась, а не висела.
awaitTermination - чтобы код после awaitTermination() не пошел дальше, т.е. это как join, чтобы main дальше не пошел выполняться, а пойдет только после тайминга.