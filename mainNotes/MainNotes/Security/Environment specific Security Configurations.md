Наш код запускается на множестве энвайрементов. 
![[Pasted image 20241224141847.png]]
Но приложение работает по-разному в этих энвайрментах. В продакшене пользователи будут вводить логин и пароль. Но вот в Lower envs могут поступить запросы от QA или других разрабов, чтобы мы для этих lower envs сделали так, чтобы для входа нужно было использовать только username, а пароль можно было бы писать любой. Это помогло бы QA специалистом не запоминать пароль, а вводить любой, что повысило бы для них удобство и скорость тестирования. Поэтому мы хотим иметь вомзонжость настраивать Spring Security в зависимости от envirionment, на котором он запущен.

В Spring есть концепция [[Profiles]], которые позволяют в зависимости от условий использовать те или иные настройки, загружать и создавать бины определенных типов.

Для каждого environment создают свой файл для конфигурации. По дефолту спринг запускается без какого-либо активного профайла, поэтому используются конфигураци из application.yml.

Создаем еще один файлик application-prod, где мы пишем конфигурации для продакшена. Тут мы можем изменить, например, пароли для БД, ее хост и порт. Тем самым, когда мы активируем профайл с именем "prod", то для конфигурации будет использован этот файлик(а точнее будут использованы и application.yml тоже, но те поля, что переопределены внутри application-prod будут главнее и значения будут использоваться из них).
![[Pasted image 20241224143200.png]]
Например, давайте в prod файле не будет показывать sql, т.к. это будет заполнять логи на проде ненужной информацией.
![[Pasted image 20241224143337.png]]
Также логировать будет только ERROR:
![[Pasted image 20241224143448.png]]

1. В application.yml указываем в import наши файлы с различными конфигурациями в зависимости от активированного профайла(также можем указать какой профайл должен быть активирован по дефолту)
![[Pasted image 20241224143825.png]]
2. Внутри файла с конфигурацией мы указываем в каком случае данный файл становится активным. В данном примере мы указали, что если приложение будет запущено с prod профайлом, то данный файл будет активирован:
![[Pasted image 20241224144009.png]]

Замечание: если мы используем нотацию application-<имя профайла>.yml, то шаги 1 и 2 можно пропустить. При активации профайла с таким именем, которое указано в <> названии файла будет использован такой файлик.

Чтобы активировать профайл можно использовать environment переменные(SPRING_PROFILES_ACTIVE=), либо в application.yml указать spring.profiles.active=name.

Теперь решим проблему, которую изначально поставили - сделать так, чтобы, если был запущен не production профайл, а какой-то lower level envs, то пароль можно было вводить любой.

Указываем просто аннотацией @Profile над классом, что мы хотим, чтобы бин этого класса создался в случае активации профайла prod.
![[Pasted image 20241224151355.png]]
А для не продакшен мы создаем еще один класс, в котором уже не будем проверять пароль и чтобы именно такой AuthenticationProvider создавался в случае не продакшен профайла используем "!prod":
![[Pasted image 20241224151611.png]]

Аналогично мы можем делать с различными другими бинами. Например, можем написать другу конфигурацию для всего Security
![[Pasted image 20241224152002.png]]