Его нужно создавать тогда, когда нет подходящего образа на docker hub. Например, хотим запустить приложение внутри контейнера.
![[Pasted image 20241010172235.png]]
Dockerfile - файл с инструкциями для докер по созданию образа.
И еще нужно добавить, что при создании собственного образа нужно использовать какой-то базовый образ, а потом уже добавлять свои слои.

### Рассмотрим как выглядит dockerfile
![[Pasted image 20241010172352.png]]
Инструкция FROM - указывает какой базовый образ будет использоваться для нашего образа. Если тег не писать, то будет использоваться latest. alpine - самая минимальная версия образа. Но тогда могут быть недоступны какие-то вкусняшки.
![[Pasted image 20241010172442.png]]
WORKDIR /app - создается рабочая директория внутри образа. Внутри образа будет создана папка app. В эту папку мы будем помещать файлы нашего приложения. После выполнение WORKDIR докер перейдет в папку /app и все последующие команды будут выполняться в ней.

COPY source dir - эта команда скопирует все файлы(и папки) в текущей директории в директорию внутри образа. Т.е. когда мы выполнили WORKDIR то директорией внутри образа стала app. Но сам этот докер файл мы могли запускать внутри проекта, т.е. на компьютере мы находимся в какой-то другой папке. И для того, чтобы скопировать файлы из директории на компьютере в директорию внутри контейнера используется COPY . . "." - в первый раз означает, что текущая папка внутри компьютера, а вторая "." означает текущую папку внутри контейнера.

CMD - указывает команду, которая будет выполнена, когда контейнер будет создан на основании образа. И как мы знаем, мы должны запустить какой-то процесс. И в примере выше запускается процесс python и в качестве аргумента ему передается main.py. Т.е. выполнится файл main.py. Данный файл должен находиться внутри /app. И он как раз копируется на этапе COPY, если мы будет хранить наш dockerfile внутри нашего проекта.

Теперь сохраняем dockerfile. И теперь мы можем создать образ. Для этого мы должны вызвать команду `docker build .` "." - в том случае если находимся в директории, в которой есть dockerfile. С помощью `-f filename` - если у нас файл не имеет название "DockerFile", то указываем это название. По умолчанию докер будет искать файл именно с таким именем в той директории, путь к которой мы указали при вызове build.
![[Pasted image 20241010173532.png]]

Если мы хотим указать название для нашего образа(иначе будет рандомный от docker), то указываем опцию -t.
![[Pasted image 20241010173855.png]]
Если мы вызовем несколько раз эту команду с тегом latest(он добавится автоматически, если мы не укажим никакой тэг), то образ просто перезапишется.

### Что будет, если захотим создать измененную версию
Например, немного изменим python файл, который будем запускать внутри контейнера. И после этого снова запустим команду `docker build` для создания образа. Она выполнится намного быстрее, поскольку уже не нужно скачивать образ python:alpine из docker hub. Поэтому написано на первом шаге FROM CACHED:
![[Pasted image 20241010175922.png]]
А вот на третьем этапе(COPY) мы не видим CACHED, поскольку был изменен файлик python и мы должны по новой скопировать.
Если мы укажем тег 2.0.0 при build, то теперь увидим, что у нас появился еще один image:
![[Pasted image 20241010180245.png]]
