Batch запросы используются в INSERT, UPDATE, DELETE запросах для того, чтобы отправлять сразу несколько запросов батчем.
Если мы не используем batch запросы, то каждый наш запрос отдельно передается по TCP/IP соединению в БД и потом еще возвращается ответ по этому же соединению. И если мы сделали 4 запроса, то мы 4 раза ходим из нашего сервера, где установлено Java приложение в сервер, где установлена БД. И мы теряем в производительности.
![[Pasted image 20240909203046.png]]

Используя Batch запросы мы можем соединить все запросы и отправить их на выполнение в БД одним прогоном данных по TCP/IP. И если мы отправили батчем 4 запроса, то в ответ нам вернется массив из 4 значений выполнения запроса(количество вставленных/удаленных/обновленных строк).

### Напишем batch запрос
batchSize по умолчанию определяется автоматически по количеству запросов, которое мы хотим отправить в батче, но можно и задать явно размер батча.
Напишем запрос:
![[Pasted image 20240909203646.png]]
И при вызове batchUpdate есть несколько вариантов:
- Передать массив String с запросами и массив с массивом аргументов для каждого такого запроса.
- Передать 1 String запрос и массив с массивом аргументов. Тогда такой запрос выполнится столько раз, сколько элементов в массиве с массивом аругментов.
- Еще есть варианты, но нужно просто их попробовать на практике.

Вот здесь мы как раз использовали вариант с передачей 1 String запроса и передали список users, из которых с помощью stream получили массив с аргументами для каждого такого юзера и передали в jdbcTemplate. Т.е. теперь переданный строковый запрос выполнится некоторое количество раз.
![[Pasted image 20240909203824.png]]

batchUpdate возвращает массив с количество обновленных, удаленных или добавленных строк 
![[Pasted image 20240909204237.png]]

