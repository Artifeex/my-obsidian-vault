Жизненный цикл приложения Spring Boot начинается с запуска `SpringApplication`, которая инициирует всю цепочку событий, ведущих к полной инициализации и запуску приложения. Рассмотрим этот процесс по этапам:

### 1. **Инициализация** (`SpringApplication.run`)
   - В методе `SpringApplication.run` создается и настраивается объект `SpringApplication`, который запускает процесс инициализации Spring Boot приложения.
   - Применяются настройки окружения, загружаются `application.properties` или `application.yml`, а также передаются аргументы командной строки.

### 2. **Создание и настройка окружения** (`Environment`)
   - Spring создает объект `Environment`, который объединяет все источники конфигурации (системные свойства, переменные окружения, файлы конфигурации).
   - Настройки окружения определяют профили, свойства и приоритеты, которые влияют на дальнейшие этапы загрузки.

### 3. **Подготовка `ApplicationContext`**
   - Spring определяет тип контекста (`ApplicationContext`) в зависимости от типа приложения: для веб-приложений это будет `AnnotationConfigServletWebServerApplicationContext`.
   - Создается и подготавливается `ApplicationContext`, который будет содержать все бины и управлять ими на протяжении всего жизненного цикла приложения.

### 4. **Регистрация слушателей событий (`ApplicationListeners`)**
   - Все классы, реализующие интерфейс `ApplicationListener`, регистрируются для прослушивания событий в приложении.
   - Это позволяет обрабатывать события, происходящие в ходе запуска и работы приложения, такие как `ApplicationStartingEvent`, `ApplicationEnvironmentPreparedEvent`, `ApplicationPreparedEvent`, `ApplicationStartedEvent`, `ApplicationReadyEvent` и другие.

### 5. **Запуск слушателей событий и начальная конфигурация** (`ApplicationEvents`)
   - Spring Boot генерирует несколько событий на этапе запуска. Эти события можно использовать для выполнения кода на разных стадиях инициализации.
   - Примеры событий:
     - `ApplicationStartingEvent` — отправляется в начале выполнения метода `run`.
     - `ApplicationEnvironmentPreparedEvent` — отправляется после создания и подготовки окружения.
     - `ApplicationPreparedEvent` — отправляется после создания `ApplicationContext`, но до его полной инициализации.

### 6. **Сканирование компонентов и регистрация бинов**
   - Выполняется сканирование компонентов (`@ComponentScan`) и добавляются классы с аннотациями `@Component`, `@Service`, `@Repository`, `@Controller`, `@RestController`, а также классы с `@Configuration` и `@Bean`-методы.
   - Spring Boot собирает все бины и зависимости, проводит инъекцию и связывает бины согласно конфигурации.

### 7. **Вызов `@PostConstruct` и `InitializingBean`**
   - Для каждого созданного бина вызываются методы, помеченные аннотацией `@PostConstruct` или реализующие интерфейс `InitializingBean`. Это позволяет выполнять инициализацию бинов после создания их экземпляров.

### 8. **Запуск встроенного веб-сервера** (для веб-приложений)
   - Если приложение является веб-приложением, Spring Boot автоматически запускает встроенный веб-сервер (например, Tomcat, Jetty или Undertow).
   - Веб-сервер связывается с портом (по умолчанию `8080`), инициализирует сервлеты и создает контейнер для обработки HTTP-запросов.

### 9. **Запуск `CommandLineRunner` и `ApplicationRunner`**
   - После того как контекст полностью инициализирован, Spring Boot вызывает все бины, реализующие интерфейсы `CommandLineRunner` и `ApplicationRunner`.
   - Это последний этап инициализации, где можно выполнить кастомную логику сразу после запуска приложения.

### 10. **Готовность к работе** (`ApplicationReadyEvent`)
   - Когда приложение полностью запущено и готово к обработке запросов, Spring Boot отправляет событие `ApplicationReadyEvent`.
   - Приложение теперь готово для обработки входящих HTTP-запросов (если это веб-приложение) или выполнения других задач (если это консольное приложение).

### 11. **Работа приложения и управление жизненным циклом**
   - После запуска Spring Boot поддерживает приложение в рабочем состоянии, обрабатывая запросы или задачи.
   - В течение жизненного цикла приложение может отправлять события, обновлять окружение и конфигурацию, выполнять задачи по расписанию или обрабатывать другие процессы.

### 12. **Завершение работы приложения**
   - Когда приложение получает команду на завершение (например, при отправке сигнала завершения процесса), Spring Boot инициирует последовательное завершение работы.
   - Отправляется событие `ApplicationStoppingEvent`, и все бины с аннотацией `@PreDestroy` или реализующие интерфейс `DisposableBean` получают уведомление о завершении.
   - Бины освобождают ресурсы, закрывается `ApplicationContext`, и работа веб-сервера прекращается.

### Пример полного жизненного цикла
```java
@SpringBootApplication
public class Application {

    public static void main(String[] args) {
        SpringApplication.run(Application.class, args);
    }
}
```

### События жизненного цикла

- **Запуск**: `ApplicationStartingEvent`, `ApplicationEnvironmentPreparedEvent`
- **Инициализация**: `ApplicationPreparedEvent`
- **Готовность**: `ApplicationStartedEvent`, `ApplicationReadyEvent`
- **Остановка**: `ApplicationStoppingEvent`

Таким образом, Spring Boot обеспечивает контролируемую и последовательную инициализацию приложения, а также эффективное управление его жизненным циклом от начала и до завершения.