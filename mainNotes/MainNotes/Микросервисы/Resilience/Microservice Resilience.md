Смысл устойчивости в том, что что-то способно выдержать трудные времена и прийти в норму.
Рассмотрим проблемы, которые хотим решить:
![[Pasted image 20241205165451.png]]
1. Наши микросервисы редко могут выполнить всю работу самостоятельно. Они часто общаются с другими микросервисами для получения доп информации или выполнения каких-то дополнительных действий. Поэтому нам нужно настроить механизмы, чтобы если в цепочке вызовов для выполнения запроса клиента один из микросервисов зафейлился(он мог упасть или могли произойти проблемы с сетью или он в целом мог долго отвечать на запрос), то мы не хотим, чтобы это убило всю цепочку вызовов.
2. Мы должны написать какой-то fallback(запасной) механизм на случай, если один из микросервисов в цепочке не может выполнить запрос. Мы узнаем какие механизмы существуют для реализации этих fallback механизмов.
3. Мы хотим уметь предоставить возможность микросервису, который по каким-то причинам заболел)) и не может ответить нам на запрос возможность восстановиться. Это может быть дополнительные попытки сделать запрос. Например, первый запрос мог не дойти из-за сетевой проблемы, а второй запрос без проблем дошел. Также мы можем захотеть реализовать механизм timeout-ов, чтобы не постоянно спамить запросами на микросервис, который мог перестать работать из-за повышенной нагрузки, а дать ему время на выполнения других запросв и потом он сможет и наш запрос также выполнить. 

### Решение
Использовать библиотеку Resilience4j, которая как раз и дает возможность создавать устойчивые микросервисы и решить проблемы, описанные выше.
![[Pasted image 20241205170302.png]]

### Пример проблемы, в которой потребуется использование Resilience4J
![[Pasted image 20241205171030.png]]
В accounts microservice есть endpoint - /fetchCustomerDetails, который требует от accounts microservice общения с cards и loans. Но представим, что cards микросервис не отвечает. Т.е. мы послали запрос и ждем ответа, а он все не приходит и не приходит. Что имеем? У нас в accounts микросервисе thread, в котором выполнялся запрос простаиваем в ожидании, что влияет на performance всего микросервиса, т.к. параллельно в accounts микросервис обращаются другие клиенты. Но это не все! Т.к. Api Gateway ожидает ответ от accounts, в который он перенаправил запрос, то у него также простаивает thread, который ждет ответа, чтобы отправить клиенту.

Как решить? Мы можем использовать Circuit Breaker Pattern.

### [[Circuit Breaker Pattern]]
