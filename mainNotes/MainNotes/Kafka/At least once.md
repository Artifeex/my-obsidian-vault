### Со стороны производителя
Гарантия при котором сообщение доставится минимум один раз или больше.
Например, мы отправили сообщение в Kafka, и т.к. передача в kafka по http, то сообщение могло не дойти. Поэтому потребитель ждет подтверждения доставки(acknowlendgemnt) и если оно не пришло через какое-то время, то отправляет сообщение еще раз. 

Но т.к. acknowlendgment - это тоже сообщение, то оно также может не дойти до производителя, поэтому он он отправит еще одно сообщение в kafka, несмотря на то, что kafka сохранила прошлое сообщение, просто подтверждение о сохранении в kafka не дошло до потребителя. Поэтому в kafka будет две копии одного сообщения и kafka их не удаляет. И потребители также будут читать эти сообщения в том числе дубликат.
### Со стороны потребителя
Выше мы описали ситуацию, когда в kafka может появиться два дубликата сообщения. И потребители могут потребить дубликат. И потребители должны понимать это, если установлено  at least once и обрабатывать. Например, если продублировался банковский перевод, то мы не хотим, чтобы перевод выполнился дважды. 
![[Pasted image 20241105092440.png]]
Можно либо забить на дубликаты, если это не приведет к каким-то ошибкам работы. 

Либо нужно писать идемпотентных потребителей(способность нашего консьюмера обрабатывать дублированные данные так, как будто они единожды пришли. Т.е. нет последствия от дубликатов для нашей системы). 
 Либо нужно создавать фильтр дубликатов.


